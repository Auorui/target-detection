# Ultralytics 🚀 AGPL-3.0 License - https://ultralytics.com/license

# Hyperparameters for IA-YOLO恶劣天气小目标检测
# 根据论文配置：Adam优化器，学习率1e-4，batch_size=6，80epochs
# 禁用mosaic等对小目标检测有害的数据增强

lr0: 0.0001  # initial learning rate (Adam=1E-4，论文指定)
lrf: 0.01    # final OneCycleLR learning rate (lr0 * lrf)
momentum: 0.9  # Adam beta1 (论文使用Adam优化器)
weight_decay: 0.0001  # optimizer weight decay
warmup_epochs: 3.0 # warmup epochs (fractions ok)
warmup_momentum: 0.8 # warmup initial momentum
warmup_bias_lr: 0.00001 # warmup initial bias lr (与lr0保持一致比例)

# 损失函数权重调整 - 针对小目标检测
box: 0.06    # 稍微增加框损失权重，提高定位精度
cls: 0.4     # 降低分类损失权重
cls_pw: 1.0  # cls BCELoss positive_weight
obj: 1.2     # 增加目标检测损失权重，提高召回率
obj_pw: 1.0  # obj BCELoss positive_weight

# 训练参数调整
iou_t: 0.20  # IoU training threshold
anchor_t: 3.0  # 降低锚框匹配阈值，匹配更多小目标(从4.0降到3.0)
# anchors: 3  # anchors per output layer (0 to ignore)
fl_gamma: 0.0 # focal loss gamma (efficientDet default gamma=1.5)

# 数据增强 - 保留对恶劣天气检测有益的，禁用有害的
hsv_h: 0.015 # image HSV-Hue augmentation (fraction) - 保留
hsv_s: 0.7   # image HSV-Saturation augmentation (fraction) - 保留
hsv_v: 0.4   # image HSV-Value augmentation (fraction) - 保留

# 几何变换 - 适当减小幅度，避免小目标丢失
degrees: 5.0  # image rotation (+/- deg) - 小角度旋转
translate: 0.1 # image translation (+/- fraction)
scale: 0.2    # 减小缩放幅度，避免目标过小(从0.5降到0.2)
shear: 0.0    # image shear (+/- deg)
perspective: 0.0 # image perspective (+/- fraction), range 0-0.001

# 翻转增强 - 保留
flipud: 0.0   # image flip up-down (probability)
fliplr: 0.5   # image flip left-right (probability) - 保留

# 禁用对小目标检测有害的复杂数据增强
mosaic: 0.0   # 完全禁用mosaic - 对小目标检测有害
mixup: 0.0    # 禁用mixup - 对恶劣天气图像有害
copy_paste: 0.0 # 禁用copy-paste
